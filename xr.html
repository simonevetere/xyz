<!DOCTYPE html>
<html>
<head>
    <title>WebXR Image Tracking - Visore</title>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <a-scene embedded 
         arjs="sourceType: webcam; 
               sourceWidth:1280; sourceHeight:960; 
               displayWidth: 1280; displayHeight: 960;
               debugUIEnabled: false;">
    <a-scene webxr="optionalFeatures: image-tracking; trackableImages: #my-qr-img;">
        
        <a-assets>
            <img id="my-qr-img" src="qr-pattern.jpg">
        </a-assets>

        <a-entity id="anchor" ar-image-target="target: #my-qr-img">
            <a-box position="0 0.1 0" scale="0.1 0.1 0.1" color="green" id="box"></a-box>
            <a-text id="label" value="Caricamento JSON..." align="center" position="0 0.3 0" scale="0.5 0.5 0.5"></a-text>
        </a-entity>
        

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const GITHUB_URL = "https://raw.githubusercontent.com/simonevetere/xyz/refs/heads/main/test.json";
        const label = document.querySelector('#label');
        const anchor = document.querySelector('#anchor');

        // Quando il visore "aggancia" l'immagine
        anchor.addEventListener('targetFound', () => {
            console.log("QR trovato dal visore!");
            
            fetch(GITHUB_URL)
                .then(res => res.json())
                .then(data => {
                    label.setAttribute('value', data.device_name);
                })
                .catch(err => label.setAttribute('value', 'Errore JSON'));
        });

        anchor.addEventListener('targetLost', () => {
            console.log("Il visore ha perso di vista il QR");
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Test Finale AR</title>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js">
    </script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"></script>
    <script src="https://cozmo.github.io/jsQR/jsQR.js"></script>
  </head>


<body style='margin : 0px; overflow: hidden;'>

    <a-scene embedded arjs='sourceType: webcam;'>
      <a-marker preset='custom' type='pattern' url='https://prasannaboga.github.io/demo_arjs02/images/pattern-qrcode-square.patt'>
        <a-box id="myBox" color="black" position="0 0 0" rotation="45 30 45" scale="1 1 1" rotation="0 0 0" material='opacity: 0.7;'>
          <a-animation attribute="rotation" to="360 45 90" dur="9000" repeat="indefinite" easing="linear"></a-animation>
        </a-box>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
    <script>
      try {
      canvasElement = document.createElement("canvas");
      canvasContext = canvasElement.getContext("2d");
      myBox = document.querySelector("#myBox");
    
      //scan qr code and update box color
      setInterval(function() {
        video = document.querySelector("video");
        if (video && video.readyState === video.HAVE_ENOUGH_DATA) {
          canvasElement.height = video.videoHeight;
          canvasElement.width = video.videoWidth;
          canvasContext.drawImage(
            video,
            0,
            0,
            canvasElement.width,
            canvasElement.height
          );
          var imageData = canvasContext.getImageData(
            0,
            0,
            canvasElement.width,
            canvasElement.height
          );
          var qrCode = jsQR(imageData.data, imageData.width, imageData.height);
          if (qrCode && qrCode.data !== "") {
            myBox.setAttribute("color", qrCode.data);
            console.log("QR Code Data - " + qrCode.data);
          } else {
            console.log("no qr code found");
          }
        }
      }, 3000);
    } catch (error) {
      alert(error.message);
    }
    </script>
  </body>
</html>
